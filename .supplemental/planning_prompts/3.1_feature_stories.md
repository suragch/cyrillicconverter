<goal>
You’re an experienced SaaS Founder with a background in Product Design & Product Management that obsesses about product and solving peoples problems. Your job is to take the app idea, and take on a collaborative / consultative role to build out feature ideas. 

The features are listed below in <features-list> and additional info about the app is in <app-details>

Each time the user responds back to you, you integrate their responses into the overall plan, and then repeat back the entire plan, per the format below, which incorporates the clarifications
</goal>
<format>
## Features List
### Feature Category
#### Feature
- [] [User Stories]
	- [] [List personas and their user stories. For each persona, provide several stories in this format: * As a X, I want to Y, so that Z.]
##### UX/UI Considerations
Bullet-point the step-by-step journey a user will have interacting with the product in detail with regard to this specific feature.
- [] [Core Experience]
	- [] [Description of different “states” of that screen]
	- [] [How it handles state changes visually]
	- [] [Animations, information architecture, progressive disclosure, visual hierarchy, etc]
- [] [Advanced Users & Edge Cases]
	- [] [Description of different “states” of that screen]
	- [] [How it handles state changes visually]
	- [] [Animations, information architecture, progressive disclosure, visual hierarchy, etc]

</format>
<warnings-and-guidance>
<ux-guide>
You must follow these rules:
Bold simplicity with intuitive navigation creating frictionless experiences
Breathable whitespace complemented by strategic color accents for visual hierarchy
Strategic negative space calibrated for cognitive breathing room and content prioritization
Systematic color theory applied through subtle gradients and purposeful accent placement
Typography hierarchy utilizing weight variance and proportional scaling for information architecture
Visual density optimization balancing information availability with cognitive load management
Motion choreography implementing physics-based transitions for spatial continuity
Accessibility-driven contrast ratios paired with intuitive navigation patterns ensuring universal usability
Feedback responsiveness via state transitions communicating system status with minimal latency
Content-first layouts prioritizing user objectives over decorative elements for task efficiency
User goals and tasks - Understanding what users need to accomplish and designing to make those primary tasks seamless and efficient
Information architecture - Organizing content and features in a logical hierarchy that matches users' mental models
Progressive disclosure - Revealing complexity gradually to avoid overwhelming users while still providing access to advanced features
Visual hierarchy - Using size, color, contrast, and positioning to guide attention to the most important elements first
Affordances and signifiers - Making interactive elements clearly identifiable through visual cues that indicate how they work
Consistency - Maintaining uniform patterns, components, and interactions across screens to reduce cognitive load
Accessibility - Ensuring the design works for users of all abilities (color contrast, screen readers, keyboard navigation)
Error prevention - Designing to help users avoid mistakes before they happen rather than just handling errors after they occur
Feedback - Providing clear signals when actions succeed or fail, and communicating system status at all times
Performance considerations - Accounting for loading times and designing appropriate loading states
Mobile vs. desktop considerations - Adapting layouts and interactions for different device capabilities and contexts
Responsive design - Ensuring the interface works well across various screen sizes and orientations
User testing feedback loops - Incorporating iterative testing to validate assumptions and improve the design
Platform conventions - Following established patterns from iOS/Android/Web to meet user expectations
Microcopy and content strategy - Crafting clear, concise text that guides users through the experience
Aesthetic appeal - Creating a visually pleasing design that aligns with brand identity while prioritizing usability
Animations - Crafting beautiful yet subtle animations and transitions that make the app feel professional
</ux-guide>
</warnings-and-guidance>
<context>
<feature-list>
## Features (MVP)
### Client-Side Conversion Engine
This is the core feature that executes the Cyrillic-to-Traditional Mongolian conversion directly in the user's browser. It prioritizes user privacy and provides an instantaneous, offline-first experience by using dictionaries stored locally and avoiding any server-side text processing.

#### Tech Involved
*   JavaScript (ESM)
*   IndexedDB API
*   Web Workers (Potential for large text to prevent UI blocking)
*   Service Worker (For PWA functionality)

#### Main Requirements
*   **Privacy-by-design**: Conversion logic must run entirely on the client, with no text ever being uploaded to a server.
*   **Offline-first**: The application must be fully functional without an internet connection once the dictionary is cached.
*   **Performance**: Conversions for substantial texts (e.g., 1000+ words) should feel instantaneous (<500ms).
*   **Accuracy**: The engine must correctly prioritize the user's local dictionary over the shared community dictionary during lookups.

### Dual-Layer Dictionary System
This system manages two distinct data sources for conversions: a private, user-specific dictionary and a larger, read-only community dictionary. User contributions are immediately saved to their local dictionary for personal use, while the community dictionary is periodically updated from the server, ensuring all users benefit from moderated, crowdsourced data.

#### Tech Involved
*   IndexedDB
*   Service Worker with Background Sync API
*   Fetch API

#### Main Requirements
*   **Immediate Local Benefit**: A user's new word/abbreviation contributions must be available to them for conversion instantly, even before moderation.
*   **Data Segregation**: The user's local dictionary and the shared community dictionary must be stored and queried separately.
*   **Efficient Syncing**: The PWA must handle an initial large dictionary download (~3MB) and subsequent smaller, incremental updates efficiently in the background without disrupting the user experience.
*   **Resilience**: The system must function correctly if a user remains offline for extended periods and then reconnects.

### Crowdsourcing & Moderation API
This is the backend service responsible for ingesting, managing, and serving all community-driven translation data. It handles user authentication for moderators, processes new word submissions, and enforces the multi-stage moderation workflow to ensure the quality of the shared dictionary.

#### Tech Involved
*   Dart Shelf (API Framework)
*   PostgreSQL (Primary Datastore)
*   PocketBase (Authentication & User Management)
*   Docker (Containerization)

#### Main Requirements
*   **Quality Control**: A rigorous, multi-tier approval system (net +5 for accepted, net -3 for rejected) is required to maintain dictionary integrity.
*   **Role-Based Access Control**: The API must securely differentiate between anonymous users, authenticated contributors, and trusted moderators.
*   **Scalability**: The database schema and API endpoints must be designed to handle millions of word pairs and thousands of concurrent users syncing data.
*   **Moderator Anonymity**: The system must support blind reviews where moderators cannot see the votes of other moderators to prevent bias.

## System Diagram
```mermaid
graph TD
    subgraph Client (Browser/PWA)
        UI[User Interface - HTML/CSS/JS]
        Engine[Conversion Engine]
        DB[IndexedDB]
        SW[Service Worker]
        
        UI -- User Input --> Engine
        Engine -- Dictionary Lookup --> DB
        UI -- Contribution --> DB
        UI -- Contribution for Review --> SW
        DB -- User & Community Dictionaries --> Engine
        SW -- Background Sync --> API
    end

    subgraph CDN (GitHub Pages / Cloudflare)
        Static[Static Assets - App Shell, Fonts]
    end

    subgraph Backend (VPS)
        API[API Server - Dart Shelf]
        Auth[Authentication - PocketBase]
        Database[(PostgreSQL)]
        
        API -- CRUD Operations --> Database
        API -- Verify Role --> Auth
        Moderator -- Moderation Actions --> API
    end

    User[User] -- Interacts With --> UI
    Moderator[Moderator] -- Manages Data --> UI
    User -- Initial Load --> CDN
    SW -- Caches --> Static
```

## List of Technical/Architecture Consideration Questions
*   **Frontend Framework Choice**: The spec mentions Vanilla JS or a lightweight framework. Given the complexity of state management (UI state, conversion choices, auth status, local/remote data), would a minimal framework like Svelte or Vue provide significant development velocity and maintainability advantages over Vanilla JS without a major performance trade-off?

That is fine to use something besides Vanilla JS. Whatever you think is best.

*   **Backend Stack Complexity**: The proposed backend uses Dart Shelf, PocketBase, and PostgreSQL. Was a more integrated "Backend-as-a-Service" like Supabase considered? Supabase uses PostgreSQL and could potentially consolidate the API and authentication layers, possibly simplifying deployment and maintenance. What are the key drivers for choosing the Dart Shelf + PocketBase combination?

I'd like to stick with Dart Shelf, PocketBase, and PostgreSQL because I am familiar with them and Supabase is maybe too expensive for me.

*   **Anonymous Contributions**: Hashing IP addresses is a good privacy measure. What is the strategy for preventing spam or low-quality anonymous submissions? Will there be stricter rate-limiting or a CAPTCHA-like mechanism for anonymous contributors?

That would be good to add rate limiting.


</feature-list>
<app-details>

# Cyrillic-Traditional Mongolian Converter: Project Specification v3

## Elevator Pitch
A privacy-first web app that converts Cyrillic Mongolian text to Traditional Mongolian script instantly in your browser—no server uploads required. Built on crowdsourced translation data with rigorous quality control, it empowers the Mongolian community to preserve and improve their linguistic heritage collaboratively while maintaining complete text privacy. Users can contribute translations that are immediately available locally, even before moderator approval.

## Problem Statement
Mongolian speakers who want to convert between Cyrillic and Traditional Mongolian script face several challenges:
- **Privacy concerns**: Existing tools often require uploading documents to external servers
- **Incomplete dictionaries**: Many proper nouns, technical terms, and modern vocabulary lack Traditional Mongolian equivalents
- **Limited community input**: Translations are often siloed, with no mechanism for collective improvement
- **Quality inconsistency**: Multiple valid spellings exist without guidance on which to use
- **Immediate needs vs community building**: Users need translations now but also want to contribute to shared knowledge

## Target Audience
**Primary Users:**
- Mongolian language learners and educators
- Cultural preservationists and historians
- Writers and content creators working with Traditional Mongolian script
- Government and institutional workers needing script conversion

**Secondary Users:**
- Linguists and researchers
- Diaspora communities reconnecting with traditional script
- Tourists and casual users exploring Mongolian language

## USP
- **Privacy-by-design**: All conversions happen client-side in the browser with no server uploads
- **Zero-friction access**: Instant conversion without signup
- **Immediate + community benefit**: Contributions are available locally instantly AND shared with community after moderation
- **Dual-layer dictionary**: User's personal dictionary + shared community dictionary
- **Rigorous quality control**: Multi-tier moderation system (net +5 approvals = fully accepted, net -3 = rejected)
- **Context-aware contributions**: Reviewers see surrounding words to validate rare/unusual terms
- **Progressive Web App**: Works offline with automatic database updates when online

## Target Platforms
- **Primary**: Progressive Web App (PWA) for modern browsers (Chrome, Firefox, Safari, Edge)
- **Responsive design**: Desktop and mobile web
- **Offline-first**: Full functionality without internet connection once dictionary is cached

---

## Features List

### Core Conversion Feature
- [ ] **As a user, I can paste or type Cyrillic text into an input area** so that I can convert it to Traditional Mongolian
  - [ ] Input field supports unlimited text length (with performance considerations)
  - [ ] Real-time character count displayed
  - [ ] Clear/reset button to empty input field for new conversions
- [ ] **As a user, I can click a "Convert" button** to transform my Cyrillic text to Traditional Mongolian
  - [ ] Conversion happens entirely in browser (client-side JavaScript)
  - [ ] No loading indicator needed (should be near-instant with local processing)
  - [ ] Abbreviation expansion happens first (lookup in abbreviation dictionary)
  - [ ] Then direct dictionary lookup for word-by-word conversion
  - [ ] Lookup order: User's local dictionary → Shared community dictionary
- [ ] **As a user, unconverted words remain in Cyrillic** in the output so I know what needs translation
  - [ ] Unconverted words are visually highlighted (e.g., red underline or different styling)
  - [ ] Clickable to contribute translation
- [ ] **As a user, I can copy the converted text with one click** to use it elsewhere
  - [ ] "Copy to Clipboard" button with visual confirmation feedback
  - [ ] **Conversion from Menksoft code to Unicode happens during copy operation**
  - [ ] Display uses Menksoft font/encoding
  - [ ] Clipboard receives Unicode-encoded Traditional Mongolian
  - [ ] Fallback mechanism for browsers without Clipboard API

### Menksoft-Unicode Handling
- [ ] **The system displays Traditional Mongolian using Menksoft font** for visual rendering
  - [ ] Web font provided and loaded for consistent display
  - [ ] Menksoft encoding used internally for display
- [ ] **The system converts Menksoft to Unicode on copy** for compatibility
  - [ ] Algorithm provided by you (ported from Dart) will be implemented
  - [ ] Conversion happens transparently to user
  - [ ] Unicode output is clipboard-ready

### Abbreviation Handling
- [ ] **The system automatically detects abbreviations** before conversion
  - [ ] Detection rule: Any word that is more than one letter and all caps
  - [ ] Examples: БНМАУ, ЦБД, УБ
- [ ] **As a user, I am prompted to expand abbreviations** when detected and not in dictionary
  - [ ] Modal/dialog appears asking: "What does [abbreviation] stand for?"
  - [ ] User provides full expansion
  - [ ] System uses expansion for conversion in current session
  - [ ] User can choose to save expansion locally and/or submit to server
- [ ] **Abbreviation expansions are stored in dictionary** (both local and server)
  - [ ] Abbreviations go through same moderation process as word pairs
  - [ ] Multiple valid expansions supported (user chooses during conversion)
  - [ ] Database schema similar to word pairs: abbreviation, expansion, status, approvals, etc.

### Multiple Translation Options (One-to-Many)
- [ ] **As a user, I am presented with choices** when multiple Traditional Mongolian spellings exist for a Cyrillic word
  - [ ] Dialog shows the Cyrillic word and 2+ Traditional Mongolian options (rendered in Menksoft)
  - [ ] Radio button selection
  - [ ] User selects preferred translation
  - [ ] Checkbox: "Use this choice for all instances of '[word]' in this document"
  - [ ] System remembers choice for current session/document only
  - [ ] All instances are updated if "use for all" is selected
- [ ] **System does NOT track** which variant is most commonly selected (future feature)

### Dictionary & Crowdsourcing - Dual-Layer System
- [ ] **As a user, I have both a local dictionary AND access to shared dictionary**
  - [ ] Local dictionary: User's personal contributions and choices (stored in IndexedDB)
  - [ ] Shared dictionary: Community-approved translations (synced from server)
  - [ ] Conversion lookup priority: Local first, then shared
- [ ] **As a user, I can click on unconverted words** to contribute their translation
  - [ ] Unconverted words are visually highlighted (e.g., red underline or different styling)
  - [ ] Clicking opens a contribution modal/panel
  - [ ] Anonymous users can contribute (IP address recorded but not displayed publicly)
- [ ] **As a contributor, I see context when adding translations** to help reviewers validate rare words
  - [ ] Display **2 words before and 2 words after** the target word
  - [ ] Context stops at punctuation boundaries (period, comma, semicolon, etc.)
  - [ ] Context is read-only, for reference during review
  - [ ] Cyrillic word pre-populated in input field
  - [ ] Latin character input field for Traditional Mongolian transliteration (custom romanization system)
  - [ ] Live preview of Traditional Mongolian script (Menksoft) as Latin characters are typed
- [ ] **As a contributor, I can use a popup keyboard** to help with Latin-to-Mongolian character mappings
  - [ ] Optional on-screen keyboard showing key mappings
  - [ ] Keyboard can be toggled on/off
  - [ ] Visual guide showing which Latin letters map to which Mongolian characters (custom system provided later)
- [ ] **As a contributor, I can choose where to save my contribution**
  - [ ] Option 1: "Save locally only" - Immediately available in user's local dictionary
  - [ ] Option 2: "Save locally AND submit for review" - Available locally + submitted to server for moderation
  - [ ] Both options make the word immediately usable for the contributor
  - [ ] Server submissions go through moderation process
  - [ ] **Even if rejected by moderators, word remains in user's local dictionary**
- [ ] **Contributions are recorded with metadata** for moderation tracking (server submissions only)
  - [ ] Logged-in users: user ID, timestamp
  - [ ] Anonymous users: IP address, timestamp
  - [ ] Word status: pending, probation (net positive approvals), accepted (net +5 approvals), rejected (net -3 approvals)
  - [ ] Approval count: Net count of approvals minus rejections

### User Authentication & Moderation Application
- [ ] **As a user, I can sign up/log in via PocketBase** if I want to apply to become a moderator
  - [ ] PocketBase handles authentication
  - [ ] Email/password authentication
  - [ ] Optional: OAuth providers if supported by PocketBase
  - [ ] User can use core conversion features without ever signing up
- [ ] **As a logged-in user, I can apply to become a moderator** by completing an application
  - [ ] Application form includes:
    - [ ] **Test section**: Review 10 known words and mark correct/incorrect
    - [ ] Test words are the same for everyone (provided by you)
    - [ ] Passing threshold: 9/10 correct
    - [ ] **Self-description**: Text area for skills/experience in Traditional Mongolian
  - [ ] Application is submitted to existing moderators for review
  - [ ] Confirmation message: "Your application has been submitted"
- [ ] **As an existing moderator, I can review moderator applications** and approve/reject them
  - [ ] Dashboard section for pending applications
  - [ ] View applicant's test results (score out of 10) and their specific answers
  - [ ] View self-description
  - [ ] Approve or reject with optional feedback message
  - [ ] Approved applicants receive moderator privileges via PocketBase role assignment

### Moderation System
- [ ] **As a moderator, I can review and approve crowdsourced translations** to maintain quality
  - [ ] Dashboard showing pending submissions with context
  - [ ] **Context display: 2 words before/after (stopping at punctuation)** so moderators can validate rare words
  - [ ] View Cyrillic word and proposed Traditional Mongolian translation (Menksoft rendering)
  - [ ] **Blind review**: Cannot see who already approved/rejected
  - [ ] Approve/reject/edit capabilities
  - [ ] **First approval** moves word to "probation" status (immediately available to all users in MVP)
  - [ ] **Net +5 approvals** moves word to "fully accepted" status
  - [ ] **Net -3 rejections** marks word as "rejected" (not shown to users)
  - [ ] **Approval/rejection math**: Each approval adds +1, each rejection adds -1
- [ ] **As a moderator, I can edit existing dictionary entries** to fix errors
  - [ ] Search functionality to find existing entries
  - [ ] Edit interface similar to contribution interface
  - [ ] **Editing Cyrillic**: Creates a new database entry (different word)
  - [ ] **Editing Traditional Mongolian (Latin)**: Resets approval count to +1
  - [ ] Last write wins in case of simultaneous edits (rare edge case)
  - [ ] Change history/audit log showing who edited when
- [ ] **As a moderator, I can add additional Traditional Mongolian spellings** for an existing Cyrillic word
  - [ ] Creates new database entry with same Cyrillic but different Traditional Mongolian
  - [ ] New entry goes through moderation process independently
  - [ ] Results in one-to-many relationship for that Cyrillic word
- [ ] **The system tracks moderation quality** for transparency
  - [ ] Number of approvals, rejections, edits per moderator
  - [ ] Inter-moderator agreement rates (future enhancement)
  - [ ] Contribution approval rates

### Contributor Recognition
- [ ] **As a logged-in user, I can view my contribution statistics** on my profile
  - [ ] Total words contributed to server
  - [ ] Total words in local dictionary only
  - [ ] Acceptance rate (net positive vs rejected)
  - [ ] Words in probation vs fully accepted vs rejected
- [ ] **As a logged-in user, I can edit my pending contributions** before they're fully approved or rejected
  - [ ] Search or filter personal contributions
  - [ ] Edit interface opens with current values
  - [ ] Submit edited version (resets approval count to 0)
- [ ] **As a user, I can view a public leaderboard** of top contributors
  - [ ] Top contributors by total words added to server
  - [ ] Top contributors by acceptance rate (with minimum threshold, e.g., 10+ contributions)
  - [ ] Anonymous contributions are not displayed on leaderboard
  - [ ] Only logged-in user contributions appear

### Data Management & PWA

#### Database Schema

**Word Conversion Pairs Table (PostgreSQL or PocketBase)**
- [ ] word_id (primary key)
- [ ] cyrillic_word (indexed)
- [ ] traditional_mongolian_menksoft
- [ ] traditional_mongolian_latin
- [ ] context_before
- [ ] context_after
- [ ] status (pending/probation/accepted/rejected)
- [ ] approval_count (net count: approvals - rejections, indexed)
- [ ] contributor_id (nullable, foreign key to users)
- [ ] contributor_ip (nullable, hashed for privacy)
- [ ] created_at
- [ ] updated_at

**Abbreviation Expansions Table**
- [ ] abbreviation_id (primary key)
- [ ] abbreviation (indexed, e.g., "БНМАУ")
- [ ] expansion (e.g., "Бүгд Найрамдах Монгол Ард Улс")
- [ ] status (pending/probation/accepted/rejected)
- [ ] approval_count (net count)
- [ ] contributor_id (nullable)
- [ ] contributor_ip (nullable, hashed)
- [ ] created_at
- [ ] updated_at

**Moderator Actions Table**
- [ ] action_id (primary key)
- [ ] word_id or abbreviation_id (foreign key)
- [ ] moderator_id (foreign key to users)
- [ ] action_type (approve/reject/edit)
- [ ] timestamp
- [ ] notes (optional, internal only)

**Users Table (PocketBase)**
- [ ] Handled by PocketBase authentication
- [ ] Additional fields: is_moderator (boolean), moderator_approved_at

**Moderator Applications Table**
- [ ] application_id (primary key)
- [ ] user_id (foreign key)
- [ ] test_score (integer, 0-10)
- [ ] test_answers (JSON or text)
- [ ] self_description (text)
- [ ] status (pending/approved/rejected)
- [ ] reviewed_by (moderator_id, nullable)
- [ ] reviewed_at (nullable)
- [ ] created_at

#### Sync Strategy
- [ ] **The system stores crowdsourced translations on server** for community benefit
  - [ ] API endpoints for submitting new translations (words and abbreviations)
  - [ ] API endpoints for fetching dictionary data
  - [ ] API endpoints for moderator actions
- [ ] **The system uses a hybrid sync strategy** for optimal performance
  - [ ] **Full dictionary download**: When major update available (versioned)
    - [ ] Compressed dictionary (~3 MB for 2M pairs) downloaded as gzip
    - [ ] Includes words with status = probation or accepted (net approval_count >= 1)
    - [ ] Excludes rejected words (net approval_count <= -3)
    - [ ] Stored in IndexedDB for offline access
    - [ ] Versioned (e.g., v1.2.0) to track updates
  - [ ] **Incremental updates**: Fetch only changed words between full downloads
    - [ ] Delta sync API endpoint returns words added/modified since last sync timestamp
    - [ ] Updates local IndexedDB with deltas
  - [ ] **Update frequency**:
    - [ ] Initial phase: ~Weekly full updates
    - [ ] Stable phase: ~Monthly full updates
    - [ ] Incremental updates: As needed between full updates
- [ ] **Progressive Web App (PWA) functionality** for offline use
  - [ ] Service worker caches app shell, Menksoft font, and dictionary
  - [ ] Works fully offline once dictionary is downloaded
  - [ ] **Auto-update**: Background sync downloads new dictionary version when available
  - [ ] Silent notification or subtle indicator when update completes
  - [ ] No user prompt for updates (auto-apply)
  - [ ] **Offline contribution behavior**: 
    - [ ] Users can still add to local dictionary
    - [ ] Server submission disabled with message: "You're offline. This word is saved locally and will be available for server submission when you reconnect."
    - [ ] Option to queue server submissions for when online returns (future enhancement)

#### Initial Data Seeding
- [ ] **Existing word list of 20,000-30,000 words** seeded into database
  - [ ] All seeded words set to status = probation
  - [ ] All seeded words set to approval_count = 1
  - [ ] Contributor marked as "system" or special seeding account
  - [ ] These words immediately available to users in MVP

---

## UX/UI Considerations

### Main Conversion Screen
- [ ] **Split-pane layout** with input on left, output on right (desktop) or stacked (mobile)
  - [ ] Clean, minimal interface focusing on the conversion task
  - [ ] Cyrillic input uses appropriate Cyrillic font
  - [ ] Traditional Mongolian output displays vertically with Menksoft font
- [ ] **Empty state**: Helpful placeholder text guiding first-time users
  - [ ] Example: "Paste your Cyrillic Mongolian text here to convert it to Traditional Mongolian script"
  - [ ] Optional: Sample text link to try out the converter
- [ ] **Filled state**: Text populated with clear visual separation
- [ ] **Converted state**: Output area populated with Traditional Mongolian text
  - [ ] Unconverted words highlighted in distinct color (e.g., red or orange underline)
  - [ ] Copy button becomes prominent
  - [ ] Character/word count displayed
- [ ] **Offline indicator**: Subtle badge showing "Offline" status with checkmark (still functional)

### Abbreviation Expansion Dialog
- [ ] **Triggered state**: Modal appears when abbreviation detected during conversion and not in dictionary
  - [ ] Shows detected abbreviation in clear typography
  - [ ] Prompt: "What does [ABC] stand for?"
  - [ ] Text input for full expansion
  - [ ] "Skip" button to leave abbreviated
  - [ ] "Save & Expand" button with options:
    - [ ] Radio/checkbox: "Save locally only" or "Save locally AND submit for review"
- [ ] **Multiple abbreviations**: Queue them and show one at a time

### One-to-Many Choice Dialog
- [ ] **Triggered state**: Modal appears when word has multiple Traditional Mongolian spellings in dictionary
  - [ ] Displays Cyrillic word prominently at top
  - [ ] Radio button list of Traditional Mongolian options (rendered in Menksoft)
  - [ ] Each option on separate line for clarity
  - [ ] Checkbox: "Use this choice for all instances of '[word]' in this document" 
  - [ ] "Cancel" (skip this word, leave unconverted) and "Apply" buttons
  - [ ] Choice persists only for current session
- [ ] **Batch processing**: If multiple words have choices, show them sequentially

### Contribution Modal/Panel
- [ ] **Triggered state**: Modal appears when user clicks unconverted word
  - [ ] Semi-transparent overlay darkens background
  - [ ] Modal centered on screen (or bottom sheet on mobile)
  - [ ] Title: "Add Translation for '[word]'"
- [ ] **Context display section**:
  - [ ] Read-only text showing 2 words before/after (stopping at punctuation)
  - [ ] Target word highlighted in bold or different color
  - [ ] Muted/secondary styling to show it's reference-only
  - [ ] Label: "Context (for reviewers)"
- [ ] **Input sections**:
  - [ ] Cyrillic input: Pre-filled with clicked word, editable if needed
  - [ ] Latin transliteration input: Active focus state, character counter
  - [ ] Live preview: Updates in real-time as user types, shows Menksoft rendering
  - [ ] Help text with link: "Use the custom romanization system (see guide)"
- [ ] **Keyboard toggle**: Button to show/hide on-screen keyboard
  - [ ] Smooth slide-in/out animation
  - [ ] Keys highlight on hover/press
  - [ ] Key mapping labels visible (Latin → Mongolian, provided later)
- [ ] **Save options**:
  - [ ] Radio buttons or segmented control:
    - [ ] "Save locally only" (default for quick workflow)
    - [ ] "Save locally AND submit for review"
  - [ ] Help text: "Local saves are available immediately. Server submissions help the community after moderation."
- [ ] **Submit states**:
  - [ ] Validation: Error messages for required fields
  - [ ] Submitting: Loading state on button
  - [ ] Success (local only): "Saved to your personal dictionary!" confirmation, modal closes
  - [ ] Success (local + server): "Saved locally and submitted for review!" confirmation, modal closes
  - [ ] Error: Inline error message, modal remains open for retry
- [ ] **Anonymous contribution note**: Small text indicating "Contributing anonymously" if not logged in (when submitting to server)
- [ ] **Offline behavior**: If offline and user attempts server submission, show message: "You're offline. Word saved locally only. Submit to server when reconnected."

### Authentication Screens
- [ ] **Login/Signup modal or page (PocketBase integration)**
  - [ ] Tab toggle between "Login" and "Sign Up"
  - [ ] Form validation with inline error messages
  - [ ] Password strength indicator for signup
  - [ ] Success: Redirect to profile/dashboard or close modal
  - [ ] PocketBase handles session management
- [ ] **Logged-in state**: User avatar/name in header with dropdown menu
  - [ ] Links to: Profile, Apply to Moderate (if not moderator), Dashboard (if moderator), Logout

### Moderator Application Screen
- [ ] **Multi-step wizard or single-page form**
  - [ ] **Step 1: Test section** with 10 known words
    - [ ] Same 10 words in same order for all applicants (provided by you)
    - [ ] Each word shows: Cyrillic input, Traditional Mongolian output, Context
    - [ ] Radio buttons: "Correct" or "Incorrect"
    - [ ] Auto-score on submit: Must score 9/10 to pass
    - [ ] If fail (8 or below): Message "You need at least 9/10 correct. Please study and try again later." (with cooldown period?)
  - [ ] **Step 2: Self-description** (only if test passed)
    - [ ] Text area for skills/experience in Traditional Mongolian
    - [ ] Character count (minimum suggested: 100 characters)
  - [ ] Submit application button
  - [ ] Confirmation: "Your application has been submitted to moderators for review. You'll be notified via email if approved."

### Moderator Dashboard
- [ ] **Sidebar/tab navigation**:
  - [ ] Pending submissions (words & abbreviations)
  - [ ] Probation words (net 1-4 approvals)
  - [ ] Accepted words (net 5+ approvals)
  - [ ] Rejected words (net -3 or lower)
  - [ ] Moderator applications (if permission to review apps)
  - [ ] Statistics
- [ ] **Pending submissions list view**:
  - [ ] Table/card layout showing: Cyrillic word, context snippet, proposed Traditional Mongolian, date submitted
  - [ ] Filters: date range, type (word/abbreviation), has context
  - [ ] Sort: newest, oldest, random (to avoid bias)
  - [ ] **Blind review**: No contributor names or existing approval counts visible
- [ ] **Detail/review view**:
  - [ ] **Context displayed prominently**: 2 words before/after in read-only box with label
  - [ ] Cyrillic word (large, clear)
  - [ ] Proposed Traditional Mongolian (Menksoft rendering, large)
  - [ ] Latin transliteration (visible for reference, smaller)
  - [ ] Submission date
  - [ ] Action buttons:
    - [ ] "Approve" (+1 to approval count)
    - [ ] "Edit & Approve" (opens edit interface, then saves as +1 approval for edited version)
    - [ ] "Reject" (-1 to approval count, requires brief reason in dropdown or text)
  - [ ] **Similar words section**: Show existing dictionary entries with similar Cyrillic or Traditional Mongolian for reference
  - [ ] Notes field for moderation comments (internal, not shown to contributor)
  - [ ] **Status after action**: "Word approved. Current status: [Probation/Accepted]" or "Word rejected. Current net count: [-1]"
- [ ] **Moderator applications review** (if applicable):
  - [ ] List of pending applications
  - [ ] Detail view: Test score (9/10 or 10/10), individual answers, self-description
  - [ ] Approve/reject buttons
  - [ ] Optional feedback text to applicant

### Contributor Leaderboard Page
- [ ] **Public page accessible to all users**
  - [ ] Top 50 or 100 contributors listed
  - [ ] Columns: Username, Total Words Submitted, Acceptance Rate (% accepted), Fully Accepted Words
  - [ ] Filter/toggle: "All Time" vs "This Month" vs "This Year"
  - [ ] Note: "Anonymous contributions are not displayed. Only server submissions counted."

### Profile Page (Logged-in Users)
- [ ] **User statistics**:
  - [ ] Total contributions to server
  - [ ] Total words in personal local dictionary
  - [ ] Words in review (pending on server)
  - [ ] Words in probation (net 1-4 approvals)
  - [ ] Words fully accepted (net 5+ approvals)
  - [ ] Words rejected (net -3 or lower)
  - [ ] Acceptance rate percentage
- [ ] **Recent activity**: List of recent contributions with status
- [ ] **Edit contributions**: Link to view and edit pending contributions
  - [ ] List of user's pending/probation submissions
  - [ ] "Edit" button opens contribution modal pre-filled
  - [ ] Editing resets approval count to 0 (starts moderation over)
- [ ] **Settings**: Email, password change (via PocketBase), notification preferences

### Visual Hierarchy & Information Architecture
- [ ] **Primary action (Convert)**: Largest, most prominent button in main screen
- [ ] **Secondary actions (Copy, Clear)**: Smaller, less prominent but still accessible
- [ ] **Tertiary actions (Sign up, Help, Contribute)**: Text links or icon buttons
- [ ] **Progressive disclosure**: Advanced features (keyboard, moderation) hidden until needed
- [ ] **Responsive typography**: Legible fonts for Cyrillic, Latin, and Traditional Mongolian (Menksoft)
- [ ] **Color coding**: Consistent use of colors for status
  - [ ] Red/orange: Unconverted words, negative counts
  - [ ] Yellow/amber: Probation status
  - [ ] Green: Fully accepted status
  - [ ] Gray: Rejected (moderator view only)

### Animations & Microinteractions
- [ ] **Conversion**: Text appears smoothly in output (minimal animation since it's instant)
- [ ] **Copy confirmation**: Checkmark animation or toast notification ("Copied as Unicode!")
- [ ] **Unconverted word highlighting**: Gentle pulse or color shift on hover to indicate clickability
- [ ] **Modal transitions**: Smooth fade-in/scale-up animation for dialogs
- [ ] **Live preview**: Smooth character-by-character rendering as user types Latin transliteration
- [ ] **Button states**: Hover, active, disabled states with color/shadow changes
- [ ] **Database update indicator**: Subtle loading bar or notification when syncing dictionary updates (auto-update)
- [ ] **Local save confirmation**: Brief toast: "Saved to your dictionary!" when local-only save occurs

---

## Non-Functional Requirements

### Performance
- [ ] **Conversion completes in <500ms** for typical text (up to 1000 words)
  - [ ] Dictionary lookup optimized with efficient data structures (hash maps for Cyrillic keys)
  - [ ] No loading indicator needed due to speed
  - [ ] Lookup priority: User local dictionary (IndexedDB) → Shared dictionary (IndexedDB)
- [ ] **Dictionary loading strategy**:
  - [ ] Full dictionary: Compressed 3 MB download, ~50 MB uncompressed in memory (at 2M pairs)
  - [ ] Initial load: 20-30K pairs much smaller (~750 KB compressed)
  - [ ] Decompression happens asynchronously on load
  - [ ] IndexedDB storage for offline access (both shared and user-local dictionaries)
  - [ ] Incremental updates: Small delta fetches between full downloads
- [ ] **Page load time <3 seconds** on 3G connection (first visit)
  - [ ] Subsequent visits: <1 second (cached PWA)
- [ ] **Lazy loading** for moderator dashboard and non-critical features
- [ ] **Bundle size optimization**: Code splitting, tree shaking, minification
- [ ] **Menksoft font optimization**: Subset font if possible to reduce size

### Scalability
- [ ] **Client-side architecture** naturally scales (no server load for conversions)
- [ ] **Dictionary grows to 2 million pairs**:
  - [ ] Efficient data structures to handle large dictionary in memory (Map or Object with direct key access)
  - [ ] Indexing strategy for fast lookups even at scale
  - [ ] Consider Web Worker for dictionary operations if main thread blocking occurs (unlikely with hash map lookups)
- [ ] **API rate limiting** to prevent abuse:
  - [ ] Submission endpoint: 10 contributions per hour per IP/user
  - [ ] Dictionary sync endpoint: Reasonable rate limits for delta updates
  - [ ] Moderator action endpoints: Higher limits for trusted moderators
- [ ] **Database indexing** on frequently queried fields:
  - [ ] cyrillic_word (primary lookup key, unique if enforcing one spelling per submission)
  - [ ] status (for filtering pending/accepted/rejected)
  - [ ] approval_count (for filtering probation vs accepted)
  - [ ] contributor_id (for user statistics)
  - [ ] created_at, updated_at (for sorting and delta syncs)
- [ ] **CDN delivery** for static assets:
  - [ ] GitHub Pages + Cloudflare for frontend
  - [ ] Compressed dictionary files
  - [ ] Menksoft font file
- [ ] **Caching strategy**:
  - [ ] Dictionary: Long cache TTL, versioned (e.g., dictionary-v1.2.0.json.gz)
  - [ ] Service worker caching for PWA offline functionality

### Security
- [ ] **Input sanitization** to prevent XSS attacks:
  - [ ] All user-submitted Cyrillic and Latin text sanitized before storage
  - [ ] Output rendering uses proper escaping (DOMPurify or similar)
- [ ] **HTTPS only** for all server communication (enforced by Cloudflare and VPS config)
- [ ] **Authentication handled by PocketBase**:
  - [ ] JWT tokens or session cookies secured
  - [ ] httpOnly cookies for session tokens
- [ ] **Rate limiting** on submission and moderation endpoints:
  - [ ] Prevent spam submissions (10/hour per user/IP)
  - [ ] Prevent abuse of moderator actions
  - [ ] Prevent brute force on authentication
- [ ] **CORS policies** properly configured for API
  - [ ] Dart Shelf configured to accept requests from frontend domain only
- [ ] **Content Security Policy** headers to prevent injection attacks
- [ ] **Moderator permission checks** on server-side:
  - [ ] All moderator actions verified with PocketBase role/permission
  - [ ] Role-based access control (RBAC) for moderator vs regular user
  - [ ] Separate permission for reviewing moderator applications
- [ ] **IP address storage**: Comply with GDPR/privacy laws
  - [ ] IP addresses for anonymous contributions hashed (SHA-256) before storage
  - [ ] Not displayed publicly
  - [ ] Clear data retention policy (e.g., delete after 1 year or upon request)
- [ ] **SQL injection prevention**: Use parameterized queries or ORM (PostgreSQL)
- [ ] **Docker security**: VPS container best practices, non-root user, minimal attack surface

### Accessibility
- [ ] **WCAG 2.1 AA compliance** minimum target
- [ ] **Keyboard navigation** for all interactive elements:
  - [ ] Tab order logical and intuitive
  - [ ] Enter/Space activates buttons
  - [ ] Escape closes modals
  - [ ] Arrow keys for radio button groups
- [ ] **Screen reader support**:
  - [ ] Proper ARIA labels for all controls
  - [ ] Semantic HTML (button, nav, main, article, etc.)
  - [ ] Live regions for dynamic content (conversion results, notifications)
  - [ ] Alt text for icons and visual indicators
  - [ ] Descriptive button text ("Add translation for [word]" not just "Add")
- [ ] **Color contrast**: 
  - [ ] 4.5:1 minimum for normal text
  - [ ] 3:1 for large text and UI components
  - [ ] Unconverted word highlighting uses sufficient contrast (not relying on color alone)
- [ ] **Focus indicators**: Visible focus states for keyboard users (2px outline minimum, high contrast)
- [ ] **Error messages**: Announced to screen readers with role="alert"
- [ ] **Language attributes**: Proper lang tags
  - [ ] lang="mn-Cyrl" for Cyrillic Mongolian
  - [ ] lang="mn-Mong" for Traditional Mongolian
  - [ ] Helps screen readers with pronunciation
- [ ] **Resizable text**: Layout doesn't break at 200% zoom
- [ ] **Motion**: Respect prefers-reduced-motion for animations
- [ ] **Form labels**: All form inputs have associated labels (visible or aria-label)
- [ ] **Skip links**: "Skip to main content" link for keyboard users

---

## Technical Architecture

### Frontend Stack
- [ ] **Core framework**: Vanilla JavaScript or lightweight framework (React, Vue, or Svelte)
- [ ] **PWA**: Service Worker for offline functionality
- [ ] **Storage**: IndexedDB for dictionaries (user local + shared community)
- [ ] **Styling**: CSS or Tailwind CSS for responsive design
- [ ] **Build tool**: Vite or Webpack for bundling and optimization
- [ ] **Hosting**: GitHub Pages + Cloudflare CDN

### Backend Stack
- [ ] **API**: Dart Shelf server running in Docker on VPS
- [ ] **Authentication**: PocketBase (user accounts, roles, permissions)
- [ ] **Database**: PostgreSQL for dictionary data + PocketBase for auth
- [ ] **Deployment**: Docker container on VPS (self-hosted)
- [ ] **Reverse proxy**: Nginx or Caddy for HTTPS and routing

### API Endpoints (Dart Shelf)

**Dictionary Endpoints**
- [ ] `GET /api/dictionary/full?version=<timestamp>` - Download full dictionary (gzipped)
- [ ] `GET /api/dictionary/delta?since=<timestamp>` - Get incremental updates
- [ ] `POST /api/dictionary/word` - Submit new word contribution
- [ ] `PUT /api/dictionary/word/:id` - Edit existing word (user's own pending contributions)
- [ ] `POST /api/dictionary/abbreviation` - Submit new abbreviation expansion
- [ ] `PUT /api/dictionary/abbreviation/:id` - Edit existing abbreviation

**Moderation Endpoints (requires moderator role)**
- [ ] `GET /api/moderation/pending` - List pending submissions
- [ ] `GET /api/moderation/probation` - List probation words
- [ ] `GET /api/moderation/word/:id` - Get word details for review
- [ ] `POST /api/moderation/word/:id/approve` - Approve word (+1)
- [ ] `POST /api/moderation/word/:id/reject` - Reject word (-1)
- [ ] `PUT /api/moderation/word/:id/edit` - Edit and approve word

**Moderator Application Endpoints**
- [ ] `POST /api/moderator/apply` - Submit moderator application
- [ ] `GET /api/moderator/applications` - List pending applications (requires moderator role)
- [ ] `POST /api/moderator/applications/:id/approve` - Approve application
- [ ] `POST /api/moderator/applications/:id/reject` - Reject application

**User/Stats Endpoints**
- [ ] `GET /api/user/profile` - Get user's contribution stats
- [ ] `GET /api/user/contributions` - List user's submissions
- [ ] `GET /api/leaderboard` - Public contributor leaderboard

**Test Endpoints**
- [ ] `GET /api/moderator/test-questions` - Get the 10 test questions for moderator application

### Data Flow

**User Contribution Flow**
1. User clicks unconverted word
2. Modal opens with contribution form
3. User enters Traditional Mongolian (Latin transliteration)
4. User chooses: "Save locally only" OR "Save locally AND submit"
5. If local only:
   - Save to IndexedDB (user_dictionary table)
   - Close modal, word now converts for this user
6. If local + submit:
   - Save to IndexedDB (user_dictionary table)
   - POST to `/api/dictionary/word` with auth token (or anonymous)
   - Server saves to pending_submissions table
   - Close modal, word now converts for this user
7. Word remains in user's local dictionary even if later rejected by moderators

**Moderator Review Flow**
1. Moderator views pending submissions list
2. Clicks word to review (opens detail view with context)
3. Cannot see existing approval count or who submitted (blind review)
4. Moderator approves, rejects, or edits:
   - **Approve**: POST to `/api/moderation/word/:id/approve`
     - Server increments approval_count by +1
     - If count reaches +1 (first approval): status = probation
     - If count reaches +5: status = accepted
   - **Reject**: POST to `/api/moderation/word/:id/reject`
     - Server decrements approval_count by -1
     - If count reaches -3: status = rejected
   - **Edit**: PUT to `/api/moderation/word/:id/edit`
     - If editing Cyrillic: Creates new database entry
     - If editing Traditional Mongolian: Resets approval_count to +1
5. Word status updates in database
6. Next dictionary sync propagates changes to all users

**Dictionary Sync Flow**
1. PWA service worker checks for updates on app start or periodically
2. Calls `GET /api/dictionary/delta?since=<last_sync_timestamp>`
3. Server returns array of changed words (added, edited, status changed)
4. Service worker updates IndexedDB (shared_dictionary table)
5. If major version change detected:
   - Download full dictionary: `GET /api/dictionary/full?version=<new_version>`
   - Replace shared_dictionary table entirely
6. User receives subtle notification: "Dictionary updated with X new words"
7. Happens automatically in background (no user prompt)

**Conversion Flow (Client-Side)**
1. User enters Cyrillic text and clicks Convert
2. **Abbreviation Detection**: Regex finds all-caps multi-letter words
3. **Abbreviation Expansion**: For each detected abbreviation:
   - Check user_dictionary (IndexedDB) for expansion
   - If not found, check shared_dictionary (IndexedDB)
   - If not found, prompt user with modal
   - User provides expansion, optionally saves locally/submits
   - Replace abbreviation with expansion in text
4. **Word-by-Word Conversion**: Split text by whitespace
5. **Dictionary Lookup** for each word:
   - Check user_dictionary first (higher priority)
   - If not found, check shared_dictionary (status = probation or accepted only)
   - If found: Replace with Traditional Mongolian (Menksoft encoding)
   - If multiple variants exist: Prompt user with choice modal
   - If not found: Leave in Cyrillic, mark as unconverted (highlighted)
6. **Render Output**: Display converted text with Menksoft font
7. **Copy**: On copy button click, convert Menksoft to Unicode using provided algorithm

---

## Implementation Phases

### Phase 1: MVP Core (Weeks 1-4)
**Goal**: Basic conversion functionality with local-only contributions

- [ ] Frontend: Main conversion screen (input/output)
- [ ] Abbreviation detection and expansion (local storage)
- [ ] Dictionary lookup (IndexedDB, local only)
- [ ] Menksoft font rendering and Unicode conversion on copy
- [ ] Contribution modal (save locally only)
- [ ] On-screen keyboard (with placeholder mappings until provided)
- [ ] Seed database with 20-30K words (probation status)
- [ ] Basic PWA setup (service worker, offline caching)

**Deliverable**: Functional converter that works 100% offline, no server needed yet

### Phase 2: Backend & Authentication (Weeks 5-6)
**Goal**: Server integration and user accounts

- [ ] Dart Shelf API setup with Docker
- [ ] PocketBase integration for authentication
- [ ] PostgreSQL or PocketBase database schema
- [ ] API endpoints for dictionary sync (full + delta)
- [ ] API endpoints for word submission
- [ ] Frontend: Login/signup UI
- [ ] Frontend: "Save locally AND submit" option in contribution modal
- [ ] Frontend: Dictionary sync on app start
- [ ] Deploy to VPS

**Deliverable**: Users can create accounts and submit contributions to server

### Phase 3: Moderation System (Weeks 7-9)
**Goal**: Complete moderation workflow

- [ ] Moderator application form (test + self-description)
- [ ] API endpoints for moderator applications
- [ ] Moderator dashboard UI (pending, probation, accepted tabs)
- [ ] Review interface with context display
- [ ] Approve/reject/edit functionality
- [ ] Approval count tracking (net +5 = accepted, net -3 = rejected)
- [ ] Multi-variant support (one-to-many Cyrillic → Traditional Mongolian)
- [ ] Moderator application review interface

**Deliverable**: Complete moderation workflow from application to word approval

### Phase 4: User Experience Enhancements (Weeks 10-11)
**Goal**: Polish and usability improvements

- [ ] One-to-many choice dialog during conversion
- [ ] User profile page with statistics
- [ ] Contribution editing for users
- [ ] Public leaderboard
- [ ] Improved offline handling (queue submissions)
- [ ] Better sync indicators and notifications
- [ ] Accessibility audit and fixes
- [ ] Performance optimization (large dictionary handling)

**Deliverable**: Polished, user-friendly experience with full feature set

### Phase 5: Testing & Launch (Week 12)
**Goal**: Bug fixes, testing, and launch preparation

- [ ] Cross-browser testing (Chrome, Firefox, Safari, Edge)
- [ ] Mobile responsiveness testing
- [ ] Load testing (2M word dictionary simulation)
- [ ] Security audit
- [ ] Documentation (user guide, moderator guide)
- [ ] Onboarding flow for first-time users
- [ ] Beta testing with small group
- [ ] Bug fixes based on feedback

**Deliverable**: Production-ready application
